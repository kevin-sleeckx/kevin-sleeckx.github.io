<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Overuren Tracker</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="manifest" href="/manifest.json">
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; padding: 2em; max-width: 900px; margin: auto; }
    h1 { text-align: center; color: #333; }
    .footer-text {
      text-align: center;
      color: #666;
      margin-top: 1em;
    }
    @media screen and (max-width: 600px) {
      body { padding: 1em; }
    }

    /* New calendar styles */
    .calendar-container {
      background: #fff;
      padding: 1em;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 2em;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1em;
    }

    .calendar-header h2 {
      margin: 0;
      font-size: 1.5em;
    }

    .calendar-header button {
      padding: 0.5em 1em;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .calendar-header button:hover {
      background-color: #0056b3;
    }

    .calendar-weekdays, .calendar-days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }

    .calendar-weekdays div {
      text-align: center;
      font-weight: bold;
      color: #555;
    }

    .calendar-days-grid div {
      text-align: center;
      padding: 0.5em;
      border: 1px solid #eee;
      border-radius: 4px;
      min-height: 50px;
      position: relative;
    }

    .calendar-days-grid div.other-month {
      color: #ccc;
    }

    .calendar-days-grid div.today {
      border-color: #007bff;
      font-weight: bold;
    }

    .calendar-days-grid div .day-number {
      font-size: 1.2em;
      font-weight: bold;
    }

    .calendar-days-grid div .entry-indicator {
      position: absolute;
      bottom: 5px;
      left: 5px;
      width: 8px;
      height: 8px;
      background-color: #28a745;
      border-radius: 50%;
    }

    @media screen and (max-width: 600px) {
      .calendar-weekdays, .calendar-days-grid {
        gap: 2px;
      }
      .calendar-days-grid div {
        min-height: 40px;
        padding: 0.3em;
      }
      .calendar-days-grid div .day-number {
        font-size: 1em;
      }
    }
  </style>
</head>
<body>
  <div class="calendar-container">
    <div class="calendar-header">
      <button id="prevMonth">Vorige</button>
      <h2 id="currentMonthYear"></h2>
      <button id="nextMonth">Volgende</button>
    </div>
    <div class="calendar-weekdays">
      <div>Ma</div>
      <div>Di</div>
      <div>Wo</div>
      <div>Do</div>
      <div>Vr</div>
      <div>Za</div>
      <div>Zo</div>
    </div>
    <div id="calendarDays" class="calendar-days-grid">
    </div>
  </div>

  <p class="footer-text">Versie 1.6.6</p>
  <script>
    let log = JSON.parse(localStorage.getItem('overurenLog') || '[]');

    const calendarDaysGrid = document.getElementById('calendarDays');
    const currentMonthYearHeader = document.getElementById('currentMonthYear');
    const prevMonthButton = document.getElementById('prevMonth');
    const nextMonthButton = document.getElementById('nextMonth');

    let currentDate = new Date();

    function renderCalendar(date) {
      calendarDaysGrid.innerHTML = '';
      const year = date.getFullYear();
      const month = date.getMonth();

      currentMonthYearHeader.textContent = `${getMonthName(month)} ${year}`;

      const firstDayOfMonth = new Date(year, month, 1);
      const lastDayOfMonth = new Date(year, month + 1, 0);

      const firstDayOfWeek = (firstDayOfMonth.getDay() + 6) % 7;

      const daysInPrevMonth = new Date(year, month, 0).getDate();
      const startDay = daysInPrevMonth - firstDayOfWeek + 1;

      for (let i = 0; i < firstDayOfWeek; i++) {
        const dayElement = document.createElement('div');
        dayElement.classList.add('other-month');
        dayElement.textContent = startDay + i;
        calendarDaysGrid.appendChild(dayElement);
      }

      for (let i = 1; i <= lastDayOfMonth.getDate(); i++) {
        const dayElement = document.createElement('div');
        dayElement.classList.add('current-month');
        dayElement.innerHTML = `<span class="day-number">${i}</span>`;

        const dayDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
        const entriesForDay = log.filter(entry => entry.datum === dayDate);
        if (entriesForDay.length > 0) {
          dayElement.innerHTML += '<div class="entry-indicator"></div>';
          dayElement.addEventListener('click', () => {
            alert(`Entries for ${dayDate}:\n${entriesForDay.map(e => `${e.type} - ${e.uren || e.bedrag}`).join('\n')}`);
          });
        }

        const today = new Date();
        if (year === today.getFullYear() && month === today.getMonth() && i === today.getDate()) {
          dayElement.classList.add('today');
        }

        calendarDaysGrid.appendChild(dayElement);
      }

      const totalDaysDisplayed = firstDayOfWeek + lastDayOfMonth.getDate();
      const remainingDays = 42 - totalDaysDisplayed;

      for (let i = 1; i <= remainingDays; i++) {
        const dayElement = document.createElement('div');
        dayElement.classList.add('other-month');
        dayElement.textContent = i;
        calendarDaysGrid.appendChild(dayElement);
      }
    }

    function getMonthName(monthIndex) {
      const months = ['Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni', 'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'];
      return months[monthIndex];
    }

    prevMonthButton.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar(currentDate);
    });

    nextMonthButton.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar(currentDate);
    });

    renderCalendar(currentDate);

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => {
            console.log('Service Worker registered: ', registration);
          })
          .catch(error => {
            console.log('Service Worker registration failed: ', error);
          });
      });
    }
  </script>
</body>
</html>
